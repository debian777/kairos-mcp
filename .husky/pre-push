#!/bin/sh
while read local_ref local_sha remote_ref remote_sha; do
  if echo "$remote_ref" | grep -q "refs/tags/v"; then
    msg=$(git log -1 --format="%s" "$local_sha")
    if ! echo "$msg" | grep -qE "^[0-9]+\.[0-9]+\.[0-9]+$"; then
      echo ""
      echo "  ERROR: Tag pushes must be created via 'npm version'"
      echo ""
      echo "  Run one of:"
      echo "    npm version patch          # x.y.Z"
      echo "    npm version minor          # x.Y.0"
      echo "    npm version major          # X.0.0"
      echo "    npm version 2.1.0          # exact version"
      echo ""
      echo "  Then: git push --follow-tags"
      echo ""
      exit 1
    fi
  fi
done
exit 0
