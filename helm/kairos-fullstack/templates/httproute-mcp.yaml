{{- if and .Values.gateway.enabled .Values.gateway.hostname .Values.app.enabled }}
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: {{ .Values.app.name | default "kairos-mcp" }}-route
  labels:
    app.kubernetes.io/name: {{ .Values.app.name | default "kairos-mcp" }}
    app.kubernetes.io/part-of: kairos-fullstack
spec:
  parentRefs:
    - name: {{ .Values.gateway.existingGatewayName | default .Values.gateway.gatewayName }}
      {{- if or .Values.gateway.tls.secretName (and .Values.gateway.tls.certManager.enabled .Values.gateway.hostname) }}
      sectionName: https
      {{- else }}
      sectionName: http
      {{- end }}
      {{- $gwNs := .Values.gateway.existingGatewayNamespace | default .Release.Namespace }}
      {{- if ne $gwNs .Release.Namespace }}
      namespace: {{ $gwNs }}
      {{- end }}
  hostnames:
    - {{ .Values.gateway.hostname | quote }}
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: {{ .Values.gateway.routes.mcp.path | default "/" }}
      backendRefs:
        - name: {{ .Values.app.name | default "kairos-mcp" }}
          port: {{ .Values.app.port }}
{{- end }}
